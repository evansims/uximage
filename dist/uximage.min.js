/* @preserve Minified on 2014-05-25 */

/* @preserve
 * UXImage 0.2.11
 * http://github.com/evanisms/uximage/
 *
 * Copyright 2014 Evan Sims and other contributors
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the 'Software'),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.UXImage=function(){"use strict";function b(b){this.Setup=a(this.Setup,this),this.onInputEvent=a(this.onInputEvent,this),this.getBrowserState=a(this.getBrowserState,this),this.Loop=a(this.Loop,this),this.Transform=a(this.Transform,this),this.transformSource=a(this.transformSource,this),this.setSource=a(this.setSource,this),this.breakpointProcessor=a(this.breakpointProcessor,this),this.breakpointApply=a(this.breakpointApply,this),this.scrollProcessor=a(this.scrollProcessor,this),this.getElementOffsets=a(this.getElementOffsets,this),this.Analyze=a(this.Analyze,this),this.Parse=a(this.Parse,this),this.checkWebP=a(this.checkWebP,this),this.speedTestComplete=a(this.speedTestComplete,this),this.speedTest=a(this.speedTest,this);var c,d;if(this.options={speedTestUri:"//farm9.staticflickr.com/8519/8629755757_117cdebd73_o.jpg",lazyLoadDistance:500},this._ready=!1,this._deviceBandwidth=null,this._clientWebPSupport=null,this._cachedBreakpointObjects=[],this._cachedLazyObjects=[],this._inputEventCache=[],this._inputEventCache={inputTicking:!1,viewportScrollTimer:null,viewportResizeTimer:null,lastKnownScrollX:-1,lastKnownScrollY:-1,lastKnownHeight:-1,lastKnownWidth:-1},b)for(c=b.length,d=0;c>d;)this.options[b[d]]=b[d];"complete"===document.readyState||"interactive"===document.readyState?this.Setup():void 0!==window&&(window.addEventListener("onload",function(a){return function(){a.Setup()}}(this),!1),document.addEventListener("DOMContentLoaded",function(a){return function(){a.Setup()}}(this),!1))}return b.prototype.speedTest=function(a){a=a||function(){return void 0},this.checkWebP(function(b){return function(){var c,d,e;try{d=new Image,e=null,d.onload=function(){var c,d,f;f=((new Date).getTime()-e)/1e3,f=f>1?f:1,d=409600/f/1024,c=d>=150?"high":"low",b.speedTestComplete(c,a)},d.onerror=function(){b.speedTestComplete("low",a)},d.onabort=function(){b.speedTestComplete("low",a)},e=(new Date).getTime(),d.src=b.options.speedTestUri+"?r="+Math.random(),setTimeout(function(){b.speedTestComplete("low",a)},400/150*1e3+350)}catch(f){c=f,b.speedTestComplete("low",a)}}}(this))},b.prototype.speedTestComplete=function(a,b){b=b||function(){return void 0},this._deviceBandwidth||(this._deviceBandwidth=a,b())},b.prototype.checkWebP=function(a){var b;return a=a||function(){return void 0},null!==this._clientWebPSupport?void a(this._clientWebPSupport):(b=new Image,b.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",void(b.onload=b.onerror=function(c){return function(){c._clientWebPSupport=2===b.height&&2===b.width?!0:!1,a(c._clientWebPSupport)}}(this)))},b.prototype.Parse=function(a){var b,c,d;if(a=a||document.body,b=0,d=a.length)for(b=0;d>b;)this.Parse(a[b]),b+=1;else{for(c=a.getElementsByClassName("ux-image"),d=c.length,b=0;d>b;)this.Analyze(c[b]),b+=1;this.onInputEvent("scroll")}},b.prototype.Analyze=function(a){var b,c,d,e;if(a){if(b=[],e=!1,b=void 0===a.classList?a.classList:a.className.split(" "),void 0===b.indexOf)-1!==b.indexOf("ondemand")&&(e=!0);else for(c=0,d=b.length;d>c;){if("ondemand"===b[c]){e=!0;break}c++}e&&(a.setAttribute("data-uximage-state","ondemand"),this._cachedLazyObjects.push(a)),this.Transform(a)}},b.prototype.getElementOffsets=function(a){var b,c,d;if(a)return d=a.getBoundingClientRect(),b=this._inputEventCache.lastKnownScrollX,c=this._inputEventCache.lastKnownScrollY,{x:d.left+b,y:d.top+c}},b.prototype.scrollProcessor=function(){var a,b,c,d,e,f,g,h,i,j;if(this._cachedLazyObjects.length){if(h=this._inputEventCache.lastKnownScrollY,j=this._inputEventCache.lastKnownHeight,f=[],e=[],g=!1,this._deviceBandwidth){for(a=0,d=this._cachedLazyObjects.length;d>a;)b=this._cachedLazyObjects[a],void 0!==b?"ready"===b.getAttribute("data-uximage-state")?(c=this.getElementOffsets(b),h+j>=c.y-this.options.lazyLoadDistance&&h<=c.y+b.offsetHeight+this.options.lazyLoadDistance?b.getAttribute("data-loaded")||f.push(b):b.getAttribute("data-loaded")&&e.push(b),a+=1):g=!0:delete this._cachedLazyObjects[a];for(i=function(a){a.setAttribute("data-loaded","true")},a=0,d=f.length;d>a;)this.transformSource(f[a],i(f[a])),a+=1;for(a=0,d=e.length;d>a;)e[a].style.backgroundImage="",e[a].removeAttribute("data-loaded"),a+=1}(g||!this._deviceBandwidth)&&(this.viewportScrollTimer&&clearTimeout(this.viewportScrollTimer),this.viewportScrollTimer=setTimeout(function(a){return function(){a.scrollProcessor()}}(this),1e3/60))}},b.prototype.breakpointApply=function(a,b){var c,d,e;return a&&(b||"ready"===a.getAttribute("data-uximage-state"))?(e=a.getBoundingClientRect(),c=parseInt(a.getAttribute("data-breakpoint-high"),10)||null,d=parseInt(a.getAttribute("data-breakpoint"),10)||null,c||d?(c&&e.width>=c&&"high"===this._deviceBandwidth?this.setSource(a,a.getAttribute("data-src-high")):d&&e.width<=d||"low"===this._deviceBandwidth?this.setSource(a,a.getAttribute("data-src")):a.getAttribute("data-src-medium")?this.setSource(a,a.getAttribute("data-src-medium")):this.setSource(a,a.getAttribute("data-src")),!0):!1):!1},b.prototype.breakpointProcessor=function(){var a;this._deviceBandwidth&&(a=this._cachedBreakpointObjects.length,this._inputEventCache.viewportResizeTimer&&(clearTimeout(this._inputEventCache.viewportResizeTimer),this._inputEventCache.viewportResizeTimer=null),a&&(this._inputEventCache.viewportResizeTimer=setTimeout(function(b){return function(){var c;for(c=0;a>c;)b.transformSource(b._cachedBreakpointObjects[c]),c+=1}}(this),1e3/30)))},b.prototype.acceptSourceChange=function(a,b){var c;return c=a.style.backgroundImage,c?b.length?!c.length&&b.length?!0:c===b||c==="url("+b+")"||c==="url('"+b+"')"||c.substring(c.length-b.length-1)===b+")"?!1:!0:!1:!0},b.prototype.setSource=function(a,b){return a?(b&&this._clientWebPSupport&&a.getAttribute("data-use-webp")&&"webp"!==b.substring(b.lastIndexOf(".")+1)&&(b=b.substring(0,b.lastIndexOf(".")+1)+"webp"),void(this.acceptSourceChange(a,b)&&(a.style.backgroundImage="url("+b+")"))):!1},b.prototype.transformSource=function(a,b){var c;b=b||function(){return void 0},this.breakpointApply(a)||(c={low:a.getAttribute("data-src"),medium:a.getAttribute("data-src-medium"),high:a.getAttribute("data-src-high")},"low"===this._deviceBandwidth&&c.low?this.setSource(a,c.high):"high"===this._deviceBandwidth&&c.high?this.setSource(a,c.high):c.medium?this.setSource(a,c.medium):c.low&&this.setSource(a,c.low)),b()},b.prototype.Transform=function(a,b){var c,d,e,f,g;b=b||function(){return void 0},this._deviceBandwidth&&"object"==typeof a&&"DIV"===a.tagName&&"ready"!==a.getAttribute("data-uximage-state")&&(e={low:a.getAttribute("data-src"),medium:a.getAttribute("data-src-medium"),high:a.getAttribute("data-src-high")},c={height:a.getAttribute("height")||parseInt(a.style.height,10)||null,width:a.getAttribute("width")||parseInt(a.style.width,10)||null},c.width&&c.height?(d=c.height/c.width*100,a.style.width="",a.style.height="",a.style.paddingBottom=d+"%",a.removeAttribute("width"),a.removeAttribute("height"),"low"===this._deviceBandwidth&&e.low?"ondemand"!==a.getAttribute("data-uximage-state")&&this.transformSource(a):a.getAttribute("data-breakpoint-high")||a.getAttribute("data-breakpoint")?(this._cachedBreakpointObjects.push(a),"ondemand"!==a.getAttribute("data-uximage-state")&&this.breakpointApply(a,!0)):"ondemand"!==a.getAttribute("data-uximage-state")&&this.transformSource(a),a.setAttribute("data-uximage-state","ready"),b()):(f=document.createElement("img"),document.body.appendChild(f),f.style.display="block",f.style.visibility="hidden",g=e.low,g||(g=e.medium),g||(g=e.high),f.onload=function(c){return function(){a.setAttribute("width",c.offsetWidth),a.setAttribute("height",c.offsetHeight),c.parentNode.removeChild(c),c.Transform(a,b)}}(this),f.onerror=function(b){return function(){a.parentNode.removeChild(a),b.parentNode.removeChild(b)}}(this),f.src=g))},b.prototype.Loop=function(a){a=a||"scroll","resize"===a?this.breakpointProcessor():this.scrollProcessor(),this._inputEventCache.inputTicking=!1},b.prototype.getBrowserState=function(a){switch(a=a||"scroll"){case"resize":this._inputEventCache.lastKnownHeight=void 0!==window.innerHeight?window.innerHeight:(document.documentElement||document.body).clientHeight,this._inputEventCache.lastKnownWidth=void 0!==window.innerWidth?window.innerWidth:(document.documentElement||document.body).clientWidth;break;default:this._inputEventCache.lastKnownScrollX=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,this._inputEventCache.lastKnownScrollY=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}return!0},b.prototype.onInputEvent=function(a){a=a||"scroll",this._inputEventCache.inputTicking||(this._inputEventCache.inputTicking=!0,"resize"===a&&this.getBrowserState("resize"),this.getBrowserState("scroll"),this.requestAnimationFrame(this.Loop(a)))},b.prototype.Setup=function(){var a,b;this._ready||(this._ready=!0,b=document.getElementsByTagName("head")[0],a=document.createElement("style"),a.innerHTML=[".ux-image {","display: block;","max-width: 100%;","height: auto !important;","position: relative;","background: transparent url(data:image/gif;base64,R0lGODlhAQABAIAAAMz/AAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==) no-repeat center;","-ms-interpolation-mode: bicubic;","image-rendering: optimizeQuality;","-webkit-perspective: 1000;","-moz-perspective: 1000;","-ms-perspective: 1000;","-o-perspective: 1000;","perspective: 1000;","-webkit-backface-visibility: hidden;","-moz-backface-visibility: hidden;","-ms-backface-visibility: hidden;","-o-backface-visibility: hidden;","backface-visibility: hidden;","-webkit-background-size: cover;","-moz-background-size: cover;","-ms-background-size: cover;","-o-background-size: cover;","background-size: cover;","-webkit-transform: translateZ(0);","-moz-transform: translateZ(0);","-ms-transform: translateZ(0);","-o-transform: translateZ(0);","transform: translateZ(0);","}"].join(" "),b.appendChild(a),this.getBrowserState("resize"),this.getBrowserState("scroll"),document.addEventListener("scroll",function(a){return function(){a.onInputEvent("scroll")}}(this),!1),window.addEventListener("resize",function(a){return function(){a.onInputEvent("resize")}}(this),!1))},b.prototype.requestAnimationFrame=function(a){return a=a||function(){return void 0},window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,16)}},b}(),"function"==typeof define&&define("UXImage",function(){return new UXImage})}).call(this);
//# sourceMappingURL=uximage.min.map